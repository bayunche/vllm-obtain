# VLLM è·¨å¹³å°æ¨ç†æœåŠ¡ - é¡¹ç›®ç»“æ„è¯´æ˜

## ğŸ“ é¡¹ç›®ç›®å½•ç»“æ„

```
vllm-obtain/
â”œâ”€â”€ src/                           # æ ¸å¿ƒæºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ api/                       # Web API å±‚
â”‚   â”‚   â”œâ”€â”€ app.py                # Flask åº”ç”¨ä¸»ä½“
â”‚   â”‚   â”œâ”€â”€ load_balanced_app.py  # è´Ÿè½½å‡è¡¡åº”ç”¨
â”‚   â”‚   â””â”€â”€ routes/               # API è·¯ç”±å®šä¹‰
â”‚   â”‚       â”œâ”€â”€ openai_compat.py  # OpenAI å…¼å®¹æ¥å£
â”‚   â”‚       â”œâ”€â”€ management.py     # ç®¡ç†æ¥å£
â”‚   â”‚       â””â”€â”€ load_balanced.py  # è´Ÿè½½å‡è¡¡è·¯ç”±
â”‚   â”œâ”€â”€ core/                      # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ inference_engine.py   # æ¨ç†å¼•æ“æ¥å£
â”‚   â”‚   â”œâ”€â”€ model_manager.py      # æ¨¡å‹ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ load_balancer.py      # è´Ÿè½½å‡è¡¡å™¨
â”‚   â”‚   â””â”€â”€ exceptions.py         # è‡ªå®šä¹‰å¼‚å¸¸
â”‚   â”œâ”€â”€ engines/                   # æ¨ç†å¼•æ“å®ç°
â”‚   â”‚   â”œâ”€â”€ mlx_engine.py         # MLX å¼•æ“ (Apple Silicon)
â”‚   â”‚   â”œâ”€â”€ vllm_engine.py        # VLLM å¼•æ“ (CUDA/ROCm)
â”‚   â”‚   â””â”€â”€ llamacpp_engine.py    # llama.cpp å¼•æ“ (é€šç”¨)
â”‚   â””â”€â”€ utils/                     # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ config.py             # é…ç½®ç®¡ç†
â”‚       â”œâ”€â”€ logger.py             # æ—¥å¿—ç³»ç»Ÿ
â”‚       â”œâ”€â”€ platform_detector.py  # å¹³å°æ£€æµ‹
â”‚       â””â”€â”€ cluster_manager.py    # é›†ç¾¤ç®¡ç†
â”œâ”€â”€ tests/                         # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ unit/                     # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ integration/              # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ performance/              # æ€§èƒ½æµ‹è¯•
â”œâ”€â”€ models/                        # æ¨¡å‹å­˜å‚¨ç›®å½•
â”‚   â””â”€â”€ qwen-0.5b/               # Qwen2.5-0.5Bæ¨¡å‹æ–‡ä»¶
â”œâ”€â”€ logs/                          # æ—¥å¿—æ–‡ä»¶ç›®å½•
â”œâ”€â”€ cache/                         # ç¼“å­˜ç›®å½•
â”œâ”€â”€ docs/                          # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ README_PRODUCTION.md     # ç”Ÿäº§éƒ¨ç½²æŒ‡å—
â”‚   â”œâ”€â”€ Mac_Studio_å®Œæ•´æµ‹è¯•æŠ¥å‘Š_20250821.md
â”‚   â””â”€â”€ PROJECT_STRUCTURE.md     # æœ¬æ–‡æ¡£
â”œâ”€â”€ scripts/                       # è„šæœ¬å·¥å…·
â”‚   â”œâ”€â”€ concurrent_test.py        # å¹¶å‘æµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ comprehensive_test.py     # ç»¼åˆæµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ serial_stress_test.py     # ä¸²è¡Œå‹åŠ›æµ‹è¯•
â”‚   â””â”€â”€ download_model.py         # æ¨¡å‹ä¸‹è½½è„šæœ¬
â”œâ”€â”€ config/                        # é…ç½®æ–‡ä»¶æ¨¡æ¿
â”‚   â”œâ”€â”€ .env.example             # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”‚   â”œâ”€â”€ .env.mac                 # Macä¸“ç”¨é…ç½®
â”‚   â”œâ”€â”€ .env.linux               # Linuxä¸“ç”¨é…ç½®
â”‚   â””â”€â”€ .env.windows             # Windowsä¸“ç”¨é…ç½®
â”œâ”€â”€ run.py                         # ç»Ÿä¸€å¯åŠ¨è„šæœ¬
â”œâ”€â”€ requirements.txt               # Pythonä¾èµ–
â”œâ”€â”€ requirements-mac.txt           # Macä¸“ç”¨ä¾èµ–
â”œâ”€â”€ requirements-linux.txt         # Linuxä¸“ç”¨ä¾èµ–
â”œâ”€â”€ requirements-windows.txt       # Windowsä¸“ç”¨ä¾èµ–
â””â”€â”€ README.md                      # ä¸»READMEæ–‡æ¡£
```

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Web API Layer               â”‚  
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ OpenAI  â”‚ â”‚ Managementâ”‚ â”‚LoadBalanced â”‚ â”‚
â”‚  â”‚ Compat  â”‚ â”‚   API    â”‚ â”‚     API     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Core Business Layer          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Model     â”‚ â”‚  Load Balancer   â”‚   â”‚
â”‚  â”‚  Manager    â”‚ â”‚                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Inference Engine Layer        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   MLX   â”‚ â”‚  VLLM   â”‚ â”‚ llama.cpp â”‚  â”‚
â”‚  â”‚ Engine  â”‚ â”‚ Engine  â”‚ â”‚  Engine   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             Hardware Layer              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Apple       â”‚ â”‚ NVIDIA/AMD      â”‚    â”‚
â”‚  â”‚ Silicon     â”‚ â”‚ GPU / CPU       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“„ å…³é”®æ–‡ä»¶è¯´æ˜

### æ ¸å¿ƒåº”ç”¨æ–‡ä»¶

#### `run.py` - ç»Ÿä¸€å¯åŠ¨è„šæœ¬
```python
"""
è·¨å¹³å°ç»Ÿä¸€å¯åŠ¨è„šæœ¬
- è‡ªåŠ¨æ£€æµ‹è¿è¡Œç¯å¢ƒ
- æ”¯æŒå¼€å‘/ç”Ÿäº§æ¨¡å¼
- å¹³å°ç‰¹å®šä¼˜åŒ–
"""
```

#### `src/api/app.py` - Flaskåº”ç”¨ä¸»ä½“
```python
"""
Flask Webåº”ç”¨æ ¸å¿ƒ
- WSGIåº”ç”¨å·¥å‚æ¨¡å¼
- å¼‚æ­¥äº‹ä»¶å¾ªç¯ç®¡ç†
- è¯·æ±‚/å“åº”å¤„ç†
- é”™è¯¯å¤„ç†å’Œç›‘æ§
"""
```

#### `src/core/model_manager.py` - æ¨¡å‹ç®¡ç†å™¨
```python
"""
æ¨¡å‹ç”Ÿå‘½å‘¨æœŸç®¡ç†
- æ¨¡å‹åŠ è½½/å¸è½½
- å†…å­˜ç®¡ç†
- å¹¶å‘æ§åˆ¶
- å¥åº·æ£€æŸ¥
"""
```

### æ¨ç†å¼•æ“æ–‡ä»¶

#### `src/engines/mlx_engine.py` - Apple Siliconå¼•æ“
```python
"""
MLXæ¨ç†å¼•æ“ (Apple Siliconä¸“ç”¨)
- Metalæ€§èƒ½ç€è‰²å™¨åŠ é€Ÿ
- ç»Ÿä¸€å†…å­˜æ¶æ„ä¼˜åŒ–
- é«˜æ•ˆTokenç”Ÿæˆ
- Apple GPUåˆ©ç”¨
"""
```

#### `src/engines/vllm_engine.py` - GPUé€šç”¨å¼•æ“
```python
"""
VLLMæ¨ç†å¼•æ“ (NVIDIA/AMD GPU)
- CUDA/ROCmåŠ é€Ÿ
- å¤§è§„æ¨¡å¹¶è¡Œå¤„ç†
- é«˜ååé‡ä¼˜åŒ–
- åˆ†å¸ƒå¼æ¨ç†æ”¯æŒ
"""
```

#### `src/engines/llamacpp_engine.py` - CPUé€šç”¨å¼•æ“
```python
"""
llama.cppæ¨ç†å¼•æ“ (CPUé€šç”¨)
- è·¨å¹³å°CPUä¼˜åŒ–
- é‡åŒ–æ¨¡å‹æ”¯æŒ
- å†…å­˜é«˜æ•ˆè®¾è®¡
- åå¤‡å¼•æ“æ–¹æ¡ˆ
"""
```

### å·¥å…·å’Œé…ç½®æ–‡ä»¶

#### `src/utils/platform_detector.py` - å¹³å°æ£€æµ‹
```python
"""
æ™ºèƒ½å¹³å°æ£€æµ‹å™¨
- ç¡¬ä»¶æ¶æ„è¯†åˆ«
- æœ€ä½³å¼•æ“æ¨è
- æ€§èƒ½é…ç½®å»ºè®®
- å…¼å®¹æ€§æ£€æŸ¥
"""
```

#### `src/utils/config.py` - é…ç½®ç®¡ç†
```python
"""
ç»Ÿä¸€é…ç½®ç®¡ç†
- ç¯å¢ƒå˜é‡å¤„ç†
- é»˜è®¤å€¼è®¾ç½®
- é…ç½®éªŒè¯
- å¹³å°ç‰¹å®šé…ç½®
"""
```

## ğŸ”§ å¼€å‘å·¥ä½œæµ

### 1. ä»£ç ç»„ç»‡åŸåˆ™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Interface     â”‚â”€â”€â”€â”€â”‚  Implementation â”‚
â”‚   (æŠ½è±¡æ¥å£)     â”‚    â”‚   (å…·ä½“å®ç°)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                       â”‚
        â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Configuration  â”‚â”€â”€â”€â”€â”‚    Utilities    â”‚
â”‚   (é…ç½®ç®¡ç†)     â”‚    â”‚   (å·¥å…·å‡½æ•°)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æ¨¡å—ä¾èµ–å…³ç³»

```
api/ â†’ core/ â†’ engines/
 â”‚       â”‚        â”‚
 â–¼       â–¼        â–¼
utils/ â† utils/ â† utils/
```

### 3. é”™è¯¯å¤„ç†æµç¨‹

```
Request â†’ Validation â†’ Engine â†’ Response
   â”‚         â”‚          â”‚         â”‚
   â–¼         â–¼          â–¼         â–¼
Logger â† Exception â† Logger â† Monitor
```

## ğŸ§ª æµ‹è¯•æ¶æ„

### æµ‹è¯•æ–‡ä»¶ç»„ç»‡

```
tests/
â”œâ”€â”€ unit/                    # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ test_platform_detector.py
â”‚   â”œâ”€â”€ test_config.py
â”‚   â””â”€â”€ test_engines.py
â”œâ”€â”€ integration/             # é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ test_api_compatibility.py
â”‚   â””â”€â”€ test_model_management.py
â””â”€â”€ performance/             # æ€§èƒ½æµ‹è¯•
    â”œâ”€â”€ test_concurrent.py
    â””â”€â”€ test_throughput.py
```

### æµ‹è¯•ç­–ç•¥

1. **å•å…ƒæµ‹è¯•**: æµ‹è¯•ç‹¬ç«‹ç»„ä»¶åŠŸèƒ½
2. **é›†æˆæµ‹è¯•**: æµ‹è¯•ç»„ä»¶é—´äº¤äº’
3. **æ€§èƒ½æµ‹è¯•**: æµ‹è¯•ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡
4. **å…¼å®¹æ€§æµ‹è¯•**: æµ‹è¯•è·¨å¹³å°å…¼å®¹æ€§

## ğŸ”„ éƒ¨ç½²æµç¨‹

### å¼€å‘ç¯å¢ƒéƒ¨ç½²

```bash
# 1. ç¯å¢ƒå‡†å¤‡
python -m venv venv
source venv/bin/activate  # Linux/Mac
# æˆ– venv\Scripts\activate  # Windows

# 2. ä¾èµ–å®‰è£…
pip install -r requirements.txt

# 3. é…ç½®è®¾ç½®
cp .env.example .env
# ç¼–è¾‘é…ç½®...

# 4. å¼€å‘å¯åŠ¨
python run.py --mode dev
```

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

```bash
# 1. ç¯å¢ƒæ£€æŸ¥
python run.py --check-deps

# 2. ç”Ÿäº§å¯åŠ¨
python run.py --mode prod

# 3. æœåŠ¡éªŒè¯
curl http://localhost:8001/health
```

## ğŸ› ï¸ æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°çš„æ¨ç†å¼•æ“

1. **åˆ›å»ºå¼•æ“æ–‡ä»¶**
```python
# src/engines/custom_engine.py
from .base_engine import BaseInferenceEngine

class CustomEngine(BaseInferenceEngine):
    def load_model(self, model_path: str):
        # å®ç°æ¨¡å‹åŠ è½½é€»è¾‘
        pass
    
    def generate(self, prompt: str, **kwargs):
        # å®ç°æ¨ç†ç”Ÿæˆé€»è¾‘
        pass
```

2. **æ³¨å†Œå¼•æ“**
```python
# src/core/inference_engine.py
from .engines.custom_engine import CustomEngine

ENGINE_MAP = {
    'custom': CustomEngine,
    # ... å…¶ä»–å¼•æ“
}
```

3. **æ›´æ–°é…ç½®**
```bash
# .env
INFERENCE_ENGINE=custom
```

### æ·»åŠ æ–°çš„APIç«¯ç‚¹

1. **åˆ›å»ºè·¯ç”±æ–‡ä»¶**
```python
# src/api/routes/custom_routes.py
from flask import Blueprint

custom_bp = Blueprint('custom', __name__)

@custom_bp.route('/custom/endpoint', methods=['POST'])
def custom_endpoint():
    # å®ç°ç«¯ç‚¹é€»è¾‘
    pass
```

2. **æ³¨å†Œè“å›¾**
```python
# src/api/app.py
from .routes.custom_routes import custom_bp

app.register_blueprint(custom_bp, url_prefix='/v1')
```

## ğŸ“‹ ç»´æŠ¤æŒ‡å—

### æ—¥å¿—ç®¡ç†

```bash
# æ—¥å¿—ç›®å½•ç»“æ„
logs/
â”œâ”€â”€ app.log              # åº”ç”¨ä¸»æ—¥å¿—
â”œâ”€â”€ api_requests.log     # APIè¯·æ±‚æ—¥å¿—
â”œâ”€â”€ model_operations.log # æ¨¡å‹æ“ä½œæ—¥å¿—
â”œâ”€â”€ system_metrics.log   # ç³»ç»ŸæŒ‡æ ‡æ—¥å¿—
â””â”€â”€ errors.log          # é”™è¯¯æ—¥å¿—
```

### æ€§èƒ½ç›‘æ§

```python
# å…³é”®ç›‘æ§æŒ‡æ ‡
- response_time: å“åº”æ—¶é—´
- throughput: ååé‡  
- success_rate: æˆåŠŸç‡
- memory_usage: å†…å­˜ä½¿ç”¨
- cpu_usage: CPUä½¿ç”¨
- model_load_time: æ¨¡å‹åŠ è½½æ—¶é—´
```

### æ•…éšœæ’æŸ¥

1. **æ£€æŸ¥æ—¥å¿—æ–‡ä»¶**
2. **éªŒè¯é…ç½®è®¾ç½®**
3. **æµ‹è¯•ç½‘ç»œè¿æ¥**
4. **æ£€æŸ¥ç³»ç»Ÿèµ„æº**
5. **éªŒè¯æ¨¡å‹æ–‡ä»¶**

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-08-21  
**ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ